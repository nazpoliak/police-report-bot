const mysql = require('mysql');
const TelegramBot = require('node-telegram-bot-api');
const token = '5729950567:AAHTNJPjNapG2LzPSQuroe7rDG0e19pjuzo';

const bot = new TelegramBot(token, {polling: true});
const connection = mysql.createConnection({
    host: 'localhost',
    user: 'username',
    password: 'password',
    database: 'database_name'
});



bot.on("message", msg => {
    const message = msg.text;
    const chatId = msg.chat.id;

    if(message === "/start") {
        bot.sendMessage(chatId, "–í—ñ—Ç–∞—î–º–æ –í–∞—Å!üëÆ".bold(), { parse_mode: 'HTML' });
        bot.sendMessage(chatId, "–Ø–∫—â–æ –≤–∏ —Å—Ç–∞–ª–∏ —Å–≤—ñ–¥–∫–æ–º:\n- –ü–æ—Ä—É—à–µ–Ω–Ω—è –ø—Ä–∞–≤–∏–ª –¥–æ—Ä–æ–∂–Ω—å–æ–≥–æ —Ä—É—Ö—Éüöó\n- –ü–æ—Ä—É—à–µ–Ω–Ω—è –≥—Ä–æ–º–∞–¥—Å—å–∫–æ–≥–æ –ø–æ—Ä—è–¥–∫—É –∞–±–æ —ñ–Ω—à—ñ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ –ø–æ—Ä—É—à–µ–Ω–Ω—èüè¢\n–ù–∞—à –±–æ—Ç –¥–æ–ø–æ–º–æ–∂–µ –≤–∞–º –ø–æ–¥–∞—Ç–∏ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –¥–æ –ø–æ–ª—ñ—Ü—ñ—ó!ü§ñ");
        setTimeout(bot.sendMessage(chatId, "–í–∏–±–µ—Ä—ñ—Ç—å –æ–¥–∏–Ω —ñ–∑ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –ø—É–Ω–∫—Ç—ñ–≤üìã:", {
            "reply_markup": {
                "keyboard": [["–ü–æ–¥–∞—Ç–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—èüì©"],   ["–ù–∞—à—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏‚òé", "F.A.Q‚ùì"]]
                }
            }), 2000);
    } 
})


bot.on("message", msg => {
    const chatId = msg.chat.id;
    const message = msg.text;
    if (message === "–ü–æ–¥–∞—Ç–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—èüì©") {
        bot.sendMessage(chatId, "–í–∏–±–µ—Ä—ñ—Ç—å —Ç–∏–ø –ø—Ä–∞–≤–æ–ø–æ—Ä—É—à–µ–Ω–Ω—è:");
        bot.sendMessage(chatId, "–í–∏–±–µ—Ä—ñ—Ç—å –æ–¥–∏–Ω —ñ–∑ –Ω–∞—Å—Ç—É–ø–Ω–∏—Ö –ø—É–Ω–∫—Ç—ñ–≤üìã:", {
            "reply_markup": {
                "keyboard": [["–ü–æ—Ä—É—à–µ–Ω–Ω—è –ü–î–†üöì"], ["–•—É–ª—ñ–≥–∞–Ω—Å—Ç–≤–æü•ä"], ["–®–∞—Ö—Ä–∞–π—Å—Ç–≤–æüí∞"], ["–í–∏–∫–ª–∏–∫ –ø–æ–ª—ñ—Ü—ñ—ó –Ω–∞ –º—ñ—Å—Ü–µüö®"]]
            }
        })
    } else if (message === "–ù–∞—à—ñ –∫–æ–Ω—Ç–∞–∫—Ç–∏‚òé") {
        bot.sendMessage(chatId, "–ö–æ–Ω—Ç–∞–∫—Ç–∏:\n–ó–∞–≥–∞–ª—å–Ω–∞ –∫–∞–Ω—Ü–µ–ª—è—Ä—ñ—è –ù–ü–£: +38 (044) 254-78-55\n–î–ª—è –∑–∞–ø–∏—Ç—ñ–≤ –Ω–∞ –ø—É–±–ª—ñ—á–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é: +38 (044) 256-15-89\n–§–∞–∫—Å: +38 (044) 253-64-04");
    } else if (message === "F.A.Q‚ùì") {
        bot.sendMessage(chatId, "1. –î–ª—è —á–æ–≥–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ —Ü–µ–π –±–æ—Ç?\n–î–∞–Ω–∏–π –±–æ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –¥–ª—è —Å–ø—Ä–æ—â–µ–Ω–Ω—è –∫–æ–º—É–Ω—ñ–∫–∞—Ü—ñ—ó –º—ñ–∂ –≥—Ä–æ–º–∞–¥—è–Ω–∞–º–∏ —Ç–∞ –ù–ü–£, –∑—Ä—É—á–Ω–æ—Å—Ç—ñ –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –ø—Ä–æ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ñ —Ç–∞ —ñ–Ω—à–æ–≥–æ —Ä–æ–¥—É –ø–æ—Ä—É—à–µ–Ω–Ω—è, –∞ —Ç–∞–∫–æ–∂ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ —Ä–µ–∞–≥—É–≤–∞–Ω–Ω—è –Ω–∞ –Ω–∏—Ö.\n\n2. –ß–∏ –º–æ–∂—É—Ç—å —Ç—Ä–µ—Ç—ñ –æ—Å–æ–±–∏ –¥—ñ–∑–Ω–∞—Ç–∏—Å—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ –º–µ–Ω–µ?\n–†–æ–∑–≥–æ–ª–æ—à–µ–Ω–Ω—è –æ–¥–µ—Ä–∂–∞–Ω–∏—Ö –≤—ñ–¥–æ–º–æ—Å—Ç–µ–π –ø—Ä–æ –í–∞—à–µ –æ—Å–æ–±–∏—Å—Ç–µ –∂–∏—Ç—Ç—è –±–µ–∑ –í–∞—à–æ—ó –∑–≥–æ–¥–∏ –Ω–µ –¥–æ–ø—É—Å–∫–∞—î—Ç—å—Å—è, –∞ –Ω–∞ –í–∞—à–µ –ø—Ä–æ—Ö–∞–Ω–Ω—è, –∑–∞–∑–Ω–∞—á–µ–Ω–µ —É –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ, –Ω–µ –ø—ñ–¥–ª—è–≥–∞—î —Ä–æ–∑–≥–æ–ª–æ—à–µ–Ω–Ω—é –ø—Ä—ñ–∑–≤–∏—â–µ, –º—ñ—Å—Ü–µ –ø—Ä–æ–∂–∏–≤–∞–Ω–Ω—è —Ç–∞ —Ä–æ–±–æ—Ç–∏.\n\n3. –ù–∞–≤—ñ—â–æ –∑–∞–ª–∏—à–∞—Ç–∏ —Å–≤–æ—ó –∫–æ–Ω—Ç–∞–∫—Ç–∏?\n–ß–∞—Å—Ç–æ –≤–∏–Ω–∏–∫–∞—î –Ω–µ–æ–±—Ö—ñ–¥–Ω—ñ—Å—Ç—å —É—Ç–æ—á–Ω–µ–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó, –∞ –∫–æ–Ω—Ç–∞–∫—Ç–∏ –¥–∞–¥—É—Ç—å –º–æ–∂–ª–∏–≤—ñ—Å—Ç—å –±—ñ–ª—å—à —Ç–æ—á–Ω–æ —Ç–∞ –æ–ø–µ—Ä–∞—Ç–∏–≤–Ω–æ –æ–ø—Ä–∞—Ü—é–≤–∞—Ç–∏ –Ω–∞–¥–∞–Ω—ñ –í–∞–º–∏ –≤—ñ–¥–æ–º–æ—Å—Ç—ñ.\n\n4. –Ø–∫ –¥–æ–≤–≥–æ —Ä–æ–∑–≥–ª—è–¥–∞—î—Ç—å—Å—è –Ω–∞–¥–∞–Ω–∞ –º–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è?\n–Ü–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è –¥–æ—Å–ª—ñ–¥–∂—É—î—Ç—å—Å—è –Ω–µ–≤—ñ–¥–∫–ª–∞–¥–Ω–æ, –∞ —É –≤–∏–ø–∞–¥–∫—É –ø—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è –Ω–∞–¥–∞–Ω–æ—ó —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –ø—Ä–æ –ø–æ—Ä—É—à–µ–Ω–Ω—è, –æ—Ä–≥–∞–Ω–∏ –î–ü–° –≤ –º–∞–∫—Å–∏–º–∞–ª—å–Ω–æ –∫–æ—Ä–æ—Ç–∫—ñ —Å—Ç—Ä–æ–∫–∏ –≤–∂–∏–≤–∞—é—Ç—å –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ –∑–∞—Ö–æ–¥–∏ —Ä–µ–∞–≥—É–≤–∞–Ω–Ω—è –¥–ª—è –ø—Ä–∏–ø–∏–Ω–µ–Ω–Ω—è –ø—Ä–æ—Ç–∏–ø—Ä–∞–≤–Ω–æ—ó –¥—ñ—è–ª—å–Ω–æ—Å—Ç—ñ.")
    }
})


bot.on("message", msg => {
    const chatId = msg.chat.id;
    const message = msg.text;
    if (message === "–ü–æ—Ä—É—à–µ–Ω–Ω—è –ü–î–†üöì" || message === "–•—É–ª—ñ–≥–∞–Ω—Å—Ç–≤–æü•ä" || message === "–®–∞—Ö—Ä–∞–π—Å—Ç–≤–æüí∞" || message === "–í–∏–∫–ª–∏–∫ –ø–æ–ª—ñ—Ü—ñ—ó –Ω–∞ –º—ñ—Å—Ü–µüö®") {
        bot.sendMessage(chatId, `–¢–∏–ø –ø—Ä–∞–≤–æ–ø–æ—Ä—É—à–µ–Ω–Ω—è: ${message}`)
        bot.sendMessage(chatId, "–ö–æ–Ω–∫—Ä–µ—Ç–∏–∑—É–π—Ç–µ –¥–∞–Ω–µ –ø—Ä–∞–≤–æ–ø–æ—Ä—É—à–µ–Ω–Ω—è: ");
    }
})

bot.on('message', async (msg) => {
    const chatId = msg.chat.id;
    const userId = msg.from.id;
    
    // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞, —á–∏ —î –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è –∑ —Ñ–æ—Ç–æ/–≤—ñ–¥–µ–æ —Ç–∞ –≥–µ–æ–ª–æ–∫–∞—Ü—ñ—î—é
    if (msg.photo && msg.location && msg.text) {
        const text = msg.text;
        const photo = msg.photo[msg.photo.length - 1];
        const fileId = photo.file_id;
        const caption = msg.caption || '';
        const latitude = msg.location.latitude;
        const longitude = msg.location.longitude;
        const date = new Date(msg.date * 1000).toISOString().slice(0, 19).replace('T', ' ');
  
      // –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—ó –≤ –±–∞–∑—ñ –¥–∞–Ω–∏—Ö
      connection.query('INSERT INTO reports (user_id, file_id, caption, latitude, longitude, date, text) VALUES (?, ?, ?, ?, ?, ?, ?)', [userId, fileId, caption, latitude, longitude, date, text], (error, results, fields) => {
        if (error) throw error;
        bot.sendMessage(chatId, '–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è —É—Å–ø—ñ—à–Ω–æ –∑–±–µ—Ä–µ–∂–µ–Ω–æ!');
      });
    }
  });
